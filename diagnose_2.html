<ons-page id="diagnose_2">
  <style>
    .garden {
      position: relative;
      width: 200px;
      height: 200px;
      border: 5px solid #ccc;
      border-radius: 10px;
    }

    .ball {
      position: absolute;
      top: 90px;
      left: 90px;
      width: 20px;
      height: 20px;
      background: green;
      border-radius: 100%;
    }
    #btn {
      width: 90%;
      transform: translateX(-50%);
      position: absolute;
      left: 50%;
      bottom: 3%;
      margin-top: 100px;
      display: inline-block;
    }
  </style>

  <div class="test_2" style="margin: 0 auto; display: block; width: 90%">
    <h1>Test 1:<br />Tremor Test</h1>
    <p>
      Should you require build tools, they are included for developing.
    </p>

    <div class="garden">
      <div class="ball"></div>
    </div>
    <pre class="output"></pre>
    <ons-button id="btn">Record</ons-button>
  </div>

  <script>
    var ball = document.querySelector(".ball");
    var garden = document.querySelector(".garden");
    var output = document.querySelector(".output");

    var maxX = garden.clientWidth - ball.clientWidth;
    var maxY = garden.clientHeight - ball.clientHeight;

    var URL = "";
    var xhr = new XMLHttpRequest();

    function handleOrientation(event) {
      console.log("event ran");
      var x = event.beta; // In degree in the range [-180,180]
      var y = event.gamma; // In degree in the range [-90,90]

      /* 
  xhr.open('POST', url, true);
  xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
  xhr.send({
    x: x,
    y: y
  });
  */

      output.innerHTML = "beta : " + x + "\n";
      output.innerHTML += "gamma: " + y + "\n";

      // Because we don't want to have the device upside down
      // We constrain the x value to the range [-90,90]
      if (x > 90) {
        x = 90;
      }
      if (x < -90) {
        x = -90;
      }

      // To make computation easier we shift the range of
      // x and y to [0,180]
      x += 90;
      y += 90;

      // 10 is half the size of the ball
      // It center the positioning point to the center of the ball
      ball.style.top = (maxY * y) / 180 - 10 + "px";
      ball.style.left = (maxX * x) / 180 - 10 + "px";
    }

    var btn = document.getElementById("btn");
    var count = 0;
    btn.addEventListener("click", () => {
      switch(count) {
        case 0:
          window.addEventListener("deviceorientation", handleOrientation);
          btn.innerHTML = "Stop"
          ++count;  
          break;
        case 1:
          window.removeEventListener("deviceorientation", handleOrientation);
          console.log('removed listener')
          btn.innerHTML = "Continue"
          ++count;
          break;  
        case 2:
          console.log('push to new page');
      }

    });
  </script>
</ons-page>
